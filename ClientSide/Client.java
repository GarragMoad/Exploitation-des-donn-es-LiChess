package ClientSide;

import java.io.*;
import java.net.Socket;

public class Client {

    public static void main(String[] args) {
        // TODO Auto-generated method stub
        Socket connessione = null;
        String server = "localhost";
        int porta = 2345;
        InputStreamReader in, input;
        BufferedReader sIN, tastiera;
        OutputStream out;
        PrintWriter sOUT;
        int chois = 0;
        String msgRicevuto;

        try {
            connessione = new Socket(server, porta);
            System.out.println("connessione eseguita >> " + connessione);
        } catch (IOException e) {
            System.out.println(e);
            System.exit(-1);
        }
        try {
            // flusso in ingresso da socket
            in = new InputStreamReader(connessione.getInputStream());
            sIN = new BufferedReader(in);

            // flusso in uscita su socket
            out = connessione.getOutputStream();
            sOUT = new PrintWriter(out);
            // flusso in ingresso da tastiera

            tastiera = new BufferedReader(new InputStreamReader(System.in));
            System.out.println("Chat inizializzata. ");
            while (true) {
                System.out.println("");
                System.out.println("|------------------------------------|");
                System.out.println("|Faitez votre chois:                 |");
                System.out.println("|1) Visualisation pas a pas          |");
                System.out.println("|2) Toutes parties d'un joueur       |");
                System.out.println("|3) 5 Ouvertures plus jouÃ©es         |");
                System.out.println("|4) partie les plu courtes           |");
                System.out.println("|5) Sortir Programme                 |");
                System.out.println("|------------------------------------|");
                do {
                    System.out.print("c>> ");
                    chois = Integer.parseInt(tastiera.readLine());
                } while (chois < 0 || chois > 5);
                if (chois == 5) {
                    System.out.println("");
                    System.out.println("|-------------------------|");
                    System.out.println("|Tu veux vraiment sortir: |");
                    System.out.println("|1) OUI                   |");
                    System.out.println("|2) Non                   |");
                    System.out.println("|-------------------------|");
                    System.out.print(">> ");
                    if ((System.in.read()) == 1)
                        break;
                }
                // invia il messaggio
                sOUT.println(chois);
                switch (chois) {
                    case 1: {
                        System.out.print("|Entrez le nom du joueur1 >> ");
                        String name1 = tastiera.readLine();
                        System.out.print("|Entrez le nom du joueur2 >> ");
                        String name2 = tastiera.readLine();
                        String time;
                        do {
                            System.out.print("|Entrez l'hour (hh:min:sec) >> ");
                            time = tastiera.readLine();
                        } while (controlTime(time));
                        sOUT.println(name1);
                        sOUT.println(name2);
                        sOUT.println(time);
                        break;
                    }
                    case 2: {
                        System.out.print("|Entrez le nom du joueur >> ");
                        String name = tastiera.readLine();
                        sOUT.println(name);
                        break;
                    }
                }


                sOUT.flush();
                while (true) {
                    msgRicevuto = sIN.readLine();
                    if (!msgRicevuto.equals("fin"))
                        System.out.println(msgRicevuto);
                    else
                        break;
                }
            }
        } catch (IOException e) {
            System.out.println(e);
        }

        try {
            connessione.close();
        } catch (IOException e) {
            System.out.println(e);
        }

    }

    public static boolean controlTime(String time) {
        int hh = Integer.parseInt(time.substring(0, 2));
        int min = Integer.parseInt(time.substring(3, 5));
        int sec = Integer.parseInt(time.substring(6));
//        System.out.println(hh + "  " + min + "  " + sec);
        if (hh >= 0 && hh <= 23)
            if (min >= 0 && min < 60)
                if (sec >= 0 && sec < 60)
                    return false;
        return true;
    }

}
